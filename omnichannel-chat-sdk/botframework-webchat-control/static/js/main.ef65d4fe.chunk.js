(this["webpackJsonpbotframework-webchat-control"]=this["webpackJsonpbotframework-webchat-control"]||[]).push([[0],{1016:function(e,t){},1018:function(e,t){},1046:function(e,t){},1047:function(e,t){},1053:function(e,t){},1072:function(e,t){},1090:function(e,t){},1092:function(e,t){},1717:function(e,t){},1718:function(e,t){},1719:function(e,t){},1819:function(e,t){},1829:function(e,t){},1830:function(e,t){},1831:function(e,t){},1846:function(e,t){},2004:function(e,t,n){},2005:function(e,t,n){},2006:function(e,t,n){},2007:function(e,t,n){},2008:function(e,t,n){},2009:function(e,t,n){},2019:function(e,t,n){},2023:function(e,t,n){"use strict";n.r(t);var a,c=n(1),o=n.n(c),i=n(208),l=n.n(i),r=(n(842),n(6)),s=n.n(r),u=n(65),d=n(9),b=n(40),g=n(273),v=n.n(g),f=n(822),h=n(8);!function(e){e[e.SET_CHAT_STARTED=0]="SET_CHAT_STARTED",e[e.SET_MESSAGES=1]="SET_MESSAGES",e[e.SET_TYPING=2]="SET_TYPING",e[e.SET_AGENT_END_SESSION_EVENT=3]="SET_AGENT_END_SESSION_EVENT",e[e.SET_LOADING=4]="SET_LOADING"}(a||(a={}));var j={hasChatStarted:!1,messages:[],isTyping:!1,agentEndSessionEvent:!1,isLoading:!1},p=function(e,t){switch(t.type){case a.SET_CHAT_STARTED:return Object(u.a)(Object(u.a)({},e),{},{type:t.type,hasChatStarted:t.payload});case a.SET_MESSAGES:return Object(u.a)(Object(u.a)({},e),{},{type:t.type,messages:t.payload});case a.SET_TYPING:return Object(u.a)(Object(u.a)({},e),{},{type:t.type,isTyping:t.payload});case a.SET_AGENT_END_SESSION_EVENT:return Object(u.a)(Object(u.a)({},e),{},{type:t.type,agentEndSessionEvent:t.payload});case a.SET_LOADING:return Object(u.a)(Object(u.a)({},e),{},{type:t.type,isLoading:t.payload});default:return e}},C=Object(c.createContext)({}),m=C.Provider,O=function(e){var t=Object(c.useReducer)(p,j),n=Object(b.a)(t,2),a=n[0],o=n[1];return Object(h.jsx)(m,{value:{state:a,dispatch:o},children:e.children})},y=n(827),S=n.n(y);n(2003),n(2004);var x=function(){return Object(h.jsx)("div",{className:"loading",children:Object(h.jsx)(S.a,{type:"Puff",color:"#00BFFF",height:100,width:100})})},k=n(2035);n(2005);var w=function(e){return Object(h.jsx)("div",{className:"chat-button",onClick:e.onClick,children:Object(h.jsx)(k.a,{color:"white"})})},E=n(2036);n(2006);var V=function(e){return Object(h.jsxs)("div",{className:"chat-header",children:[Object(h.jsxs)("span",{children:[" ",e.title," "]}),Object(h.jsx)("div",{onClick:e.onClick,children:Object(h.jsx)(E.a,{})})]})},T=n(2040),M=n(2038),N=n(2041),A=n(2042),_=n(2037),D=n(2039);n(2007);var L=function(e){return Object(h.jsxs)("div",{className:"incoming-call-pop-up",children:[Object(h.jsx)("span",{children:" Incoming call "}),Object(h.jsxs)("div",{children:[Object(h.jsx)(_.a,{className:"reject-call-button",onClick:e.rejectCall}),Object(h.jsx)(M.a,{className:"accept-video-call-button",onClick:e.acceptVideoCall}),Object(h.jsx)(D.a,{className:"accept-voice-call-button",onClick:e.acceptVoiceCall})]})]})},I=(n(2008),function(){console.log("[WebChat][adjustWebChatHeightInVideoCall]");var e=document.getElementsByClassName("webchat__basic-transcript")[0],t=document.getElementById("remoteVideo"),n=document.getElementsByClassName("current-call-action-bar")[0],a=e.clientHeight-t.clientHeight-n.clientHeight;e.style.marginTop="".concat(t.clientHeight+n.clientHeight,"px"),e.style.height="".concat(a,"px")}),R=function(){console.log("[WebChat][adjustWebChatHeightIncomingCall]");var e=document.getElementsByClassName("webchat__basic-transcript")[0],t=document.getElementsByClassName("incoming-call-pop-up")[0],n=e.clientHeight-t.clientHeight;e.style.height="".concat(n,"px")},W=function(){console.log("[WebChat][adjustWebChatHeightInVoiceCall]");var e=document.getElementsByClassName("webchat__basic-transcript")[0],t=document.getElementsByClassName("current-call-action-bar")[0],n=e.clientHeight-t.clientHeight;e.style.marginTop="".concat(t.clientHeight,"px"),e.style.height="".concat(n,"px")},H=function(){console.log("[WebChat][adjustWebChatHeightNoCall]");var e=document.getElementsByClassName("webchat__basic-transcript")[0];e.style.marginTop="",e.style.height=""};var U=function(e){var t=Object(c.useState)(!1),n=Object(b.a)(t,2),a=n[0],o=n[1],i=Object(c.useState)(!1),l=Object(b.a)(i,2),r=l[0],u=l[1],g=Object(c.useState)(!1),v=Object(b.a)(g,2),f=v[0],j=v[1],p=Object(c.useState)(!1),C=Object(b.a)(p,2),m=C[0],O=C[1],y=Object(c.useState)(!1),S=Object(b.a)(y,2),x=(S[0],S[1]),k=Object(c.useState)(!1),w=Object(b.a)(k,2),E=w[0],V=w[1];Object(c.useEffect)((function(){(function(){var t=Object(d.a)(s.a.mark((function t(){var n,a,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.VoiceVideoCallingSDK,a=e.OCClient,c=e.chatToken,t.prev=1,t.next=4,n.initialize({chatToken:c,selfVideoHTMLElementId:"selfVideo",remoteVideoHTMLElementId:"remoteVideo",environment:"test",OCClient:a});case 4:console.log("[WebChat][Calling] VoiceVideoCallingProxy initialized!"),console.log(n),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(1),console.error("[WebChat][Calling] Failed to initialize VoiceVideoCalling!"),console.error(t.t0);case 12:n.onCallAdded((function(){console.log("[WebChat][Calling][CallAdded]"),o(!0),R()})),n.onCallDisconnected((function(){console.log("[WebChat][Calling][CallDisconnected]"),H(),o(!1),u(!1),j(!1)})),n.onLocalVideoStreamAdded((function(){console.log("[WebChat][Calling][LocalVideoStreamAdded]");var e=n.isMicrophoneMuted();O(e);var t=n.isRemoteVideoEnabled();x(t);var a=n.isLocalVideoEnabled();V(a),a||t?(o(!1),u(!0),j(!1)):(o(!1),u(!1),j(!0))})),n.onLocalVideoStreamRemoved((function(){console.log("[WebChat][Calling][LocalVideoStreamRemoved]");var e=n.isMicrophoneMuted();O(e);var t=n.isRemoteVideoEnabled();x(t);var a=n.isLocalVideoEnabled();V(a),a||t?(o(!1),u(!0),j(!1)):(o(!1),u(!1),j(!0))})),n.onRemoteVideoStreamAdded((function(){console.log("[WebChat][Calling][RemoteVideoStreamAdded]");var e=n.isMicrophoneMuted();O(e);var t=n.isRemoteVideoEnabled();x(t);var a=n.isLocalVideoEnabled();V(a),a||t?(o(!1),u(!0),j(!1)):(o(!1),u(!1),j(!0))})),n.onRemoteVideoStreamRemoved((function(){console.log("[WebChat][Calling][RemoteVideoStreamRemoved]");var e=n.isMicrophoneMuted();O(e);var t=n.isRemoteVideoEnabled();x(t);var a=n.isLocalVideoEnabled();V(a),a||t?(o(!1),u(!0),j(!1)):(o(!1),u(!1),j(!0))}));case 18:case"end":return t.stop()}}),t,null,[[1,8]])})));return function(){return t.apply(this,arguments)}})()()}),[e]);var D=Object(c.useCallback)(Object(d.a)(s.a.mark((function t(){var n,a,c,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[WebChat][Calling][Accept][Voice]"),n=e.VoiceVideoCallingSDK,t.next=4,n.acceptCall({withVideo:!1});case 4:o(!1),u(!1),j(!0),W(),a=n.isMicrophoneMuted(),O(a),c=n.isRemoteVideoEnabled(),x(c),i=n.isLocalVideoEnabled(),V(i);case 14:case"end":return t.stop()}}),t)}))),[e]),U=Object(c.useCallback)(Object(d.a)(s.a.mark((function t(){var n,a,c,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[WebChat][Calling][Accept][Video]"),n=e.VoiceVideoCallingSDK,t.next=4,n.acceptCall({withVideo:!0});case 4:o(!1),u(!0),j(!1),I(),a=n.isMicrophoneMuted(),O(a),c=n.isRemoteVideoEnabled(),x(c),i=n.isLocalVideoEnabled(),V(i);case 14:case"end":return t.stop()}}),t)}))),[e]),F=Object(c.useCallback)(Object(d.a)(s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[WebChat][Calling][Reject]"),n=e.VoiceVideoCallingSDK,t.next=4,n.rejectCall();case 4:o(!1),u(!1),j(!1);case 7:case"end":return t.stop()}}),t)}))),[e]),G=Object(c.useCallback)(Object(d.a)(s.a.mark((function t(){var n,a,c,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[WebChat][Calling][toggleLocalVideo]"),n=e.VoiceVideoCallingSDK,t.next=4,n.toggleLocalVideo();case 4:a=n.isMicrophoneMuted(),O(a),c=n.isRemoteVideoEnabled(),x(c),i=n.isLocalVideoEnabled(),V(i),i||c?(o(!1),u(!0),j(!1)):(o(!1),u(!1),j(!0));case 11:case"end":return t.stop()}}),t)}))),[e]),B=Object(c.useCallback)(Object(d.a)(s.a.mark((function t(){var n,a,c,i;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[WebChat][Calling][toggleMute]"),n=e.VoiceVideoCallingSDK,t.next=4,n.toggleMute();case 4:a=n.isMicrophoneMuted(),O(a),c=n.isRemoteVideoEnabled(),x(c),i=n.isLocalVideoEnabled(),V(i),i||c?(o(!1),u(!0),j(!1)):(o(!1),u(!1),j(!0));case 11:case"end":return t.stop()}}),t)}))),[e]),K=Object(c.useCallback)(Object(d.a)(s.a.mark((function t(){var n;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("[WebChat][Calling][stopCall]"),n=e.VoiceVideoCallingSDK,t.next=4,n.stopCall();case 4:case"end":return t.stop()}}),t)}))),[e]);return Object(h.jsxs)(h.Fragment,{children:[a&&Object(h.jsx)(L,{rejectCall:F,acceptVideoCall:U,acceptVoiceCall:D}),Object(h.jsxs)("div",{className:"calling ".concat(r||f?"active":""),children:[Object(h.jsxs)("div",{className:"video-container ".concat(r?"active":""),children:[Object(h.jsx)("div",{id:"remoteVideo"}),Object(h.jsx)("div",{id:"selfVideo"})]}),Object(h.jsx)("div",{children:(r||f)&&Object(h.jsxs)("div",{className:"current-call-action-bar",children:[E?Object(h.jsx)(M.a,{className:"toggle-video-button",onClick:G}):Object(h.jsx)(T.a,{className:"toggle-video-button",onClick:G}),m?Object(h.jsx)(N.a,{className:"toggle-mute-button",onClick:B}):Object(h.jsx)(A.a,{className:"toggle-mute-button",onClick:B}),Object(h.jsx)(_.a,{className:"stop-call-button",onClick:K})]})})]})]})},F=n(2043),G=n(2044);n(2009);var B=function(e){var t=Object(c.useState)(!1),n=Object(b.a)(t,2),a=n[0],o=n[1],i=Object(c.useState)(!1),l=Object(b.a)(i,2),r=l[0],s=l[1],u=Object(c.useCallback)((function(){o(!0)}),[]),d=Object(c.useCallback)((function(){o(!1)}),[]),g=Object(c.useCallback)((function(){s(!0)}),[]),v=Object(c.useCallback)((function(){s(!1)}),[]);return Object(h.jsxs)("div",{className:"action-bar",children:[Object(h.jsx)(F.a,{size:"16",color:a?"rgb(22, 27, 34)":"rgb(22, 27, 34, 0.5)",className:"download-button",onClick:e.onDownloadClick,onMouseEnter:u,onMouseLeave:d}),Object(h.jsx)(G.a,{size:"16",color:r?"rgb(22, 27, 34)":"rgb(22, 27, 34, 0.5)",className:"email-button",onClick:e.onEmailTranscriptClick,onMouseEnter:g,onMouseLeave:v})]})},K=n(0),P=n(2),z=function(){function e(){Object(K.a)(this,e),this.middlewares=void 0,this.middlewares={}}return Object(P.a)(e,[{key:"subscribe",value:function(e,t){this.middlewares[e]=t}},{key:"create",value:function(){var e=this;return console.log("[CustomStore][create]"),Object(g.createStore)({},(function(t){var n=t.dispatch;return function(t){return function(a){var c=a;if(a&&a.payload)for(var o=0,i=Object.keys(e.middlewares);o<i.length;o++){var l=i[o],r=e.middlewares[l];if(r.applicable(c)){var s=r.apply(c);s.dispatchAction&&n(s.dispatchAction),s.nextAction&&(c=s.nextAction)}}return t(c)}}}))}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}}]),e}();z._instance=void 0;var J,Y=function(){return console.log("[createCustomStore]"),z.getInstance()},q=function(){function e(t){Object(K.a)(this,e),this.dataMaskingRules=void 0,this.dataMaskingRules=t,console.log("[DataMaskingRules]"),console.log(this.dataMaskingRules)}return Object(P.a)(e,[{key:"applicable",value:function(e){var t=e.payload.text;return!!(Object.keys(this.dataMaskingRules).length>0&&t&&"WEB_CHAT/SEND_MESSAGE"===e.type)}},{key:"apply",value:function(e){return{dispatchAction:null,nextAction:this.applyDataMasking(e)}}},{key:"applyDataMasking",value:function(e){var t=e.payload.text;if(Object.keys(this.dataMaskingRules).length>0)for(var n=0,a=Object.values(this.dataMaskingRules);n<a.length;n++)for(var c=a[n],o=new RegExp(c,"g"),i=void 0;i=o.exec(t);){var l=i[0].replace(/./g,"#");t=t.replace(i[0],l)}return e.payload.text=t,e}}]),e}(),Q=function(e){return console.log("[createDataMaskingMiddleware]"),new q(e)},X=function(){console.log("[createActivityMiddleware]");return function(){return function(e){return function(t){if(console.log("%c [ActivityMiddleware]","background: #2a9fd4; color: #fff"),console.log(t),t.activity){if(t.activity.channelData&&t.activity.channelData.tags&&t.activity.channelData.tags.includes("system"))return console.log("%c [ActivityMiddleware][Message][System] ".concat(t.activity.text),"background: #2a9fd4; color: #fff"),function(n){return Object(h.jsx)("div",{className:"system-message",children:e(t)(n)},t.activity.id)};if(void 0===t.activity.text||null==t.activity.text)return e(t);"bot"===t.activity.from.role&&console.log("%c [ActivityMiddleware][Message][Agent] ".concat(t.activity.text),"background: #2a9fd4; color: #fff"),"user"===t.activity.from.role&&console.log("%c [ActivityMiddleware][Message][Customer] ".concat(t.activity.text),"background: #2a9fd4; color: #fff")}return e(t)}}}},Z=n(2045),$=function(e){if(e){var t=e.split(/\s/).reduce((function(e,t){return e+t.slice(0,1)}),"");return t.length>1?t.substring(0,2).toUpperCase():e.substring(0,2).toUpperCase()}return""},ee=function(){console.log("[createAvatarMiddleware]");return function(){return function(e){return function(t){console.log("[AvatarMiddleware]");var n=t.activity,a=n.channelData.tags,c=n.from.name,o=n.text,i=t.fromUser;return console.log(t),a&&a.includes("system")?(console.log("[AvatarMiddleware][Message][System] ".concat(o)),Object(h.jsx)("div",{children:Object(h.jsx)(Z.a,{color:"red",size:20})})):void 0!==i&&null!==i&&(i?i?(console.log("[AvatarMiddleware][Message][Customer] ".concat(o)),Object(h.jsx)("div",{className:"webchat__avatar",children:Object(h.jsxs)("p",{className:"webchat__avatar_initials",children:[" ",$(c)||"CU","  "]})})):e(t):(console.log("[AvatarMiddleware][Message][Agent] ".concat(o)),Object(h.jsx)("div",{className:"webchat__avatar",children:Object(h.jsxs)("p",{className:"webchat__avatar_initials",children:[" ",$(c)," "]})})))}}}};!function(e){e.Sending="sending",e.SendFailed="send failed",e.Sent="sent"}(J||(J={}));var te=function(){return function(){return function(e){return function(e){console.log("%c [activityStatusMiddleware]","background: #238636; color: #fff"),console.log(e);var t="";!function(e){return e.activity.channelData&&e.activity.channelData.tags&&e.activity.channelData.tags.includes("system")}(e)?!function(e){return"bot"===e.activity.from.role}(e)?function(e){return"user"===e.activity.from.role}(e)&&(t="Customer"):t="Agent":t="System",console.log("%c [activityStatusMiddleware][Message][".concat(t,"] ").concat(e.activity.text),"background: #238636; color: #fff"),e.sendState===J.Sent?console.log("%c [activityStatusMiddleware][Message][".concat(t,"][Status] Sent!"),"background: #238636; color: #fff"):e.sendState===J.Sending?console.log("%c [activityStatusMiddleware][Message][".concat(t,"][Status] Sending..."),"background: #238636; color: #fff"):e.sendState===J.SendFailed&&console.log("%c [activityStatusMiddleware][Message][".concat(t,"][Status] Failed :("),"background: #238636; color: #fff")}}}},ne=function e(){Object(K.a)(this,e)};ne.liveChatVersion=1,ne.canUploadAttachment=!1;var ae=function(e){var t=e.LiveChatVersion,n="true"===e.LiveWSAndLiveChatEngJoin.msdyn_enablefileattachmentsforcustomers||!1;return ne.liveChatVersion=parseInt(t)||1,ne.canUploadAttachment=n,ne},ce=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};console.log("[createTypingIndicatorMiddleware]");var t=function(){return function(t){return function(t){console.log("%c [typingIndicatorMiddleware]","background: #2266e3; color: #fff"),console.log(t);var n=t.activeTyping,a=t.visible;if(!n||1===ne.liveChatVersion&&!a)return null;var c=Object.keys(n).map((function(e){return n[e]}));return c.filter((function(e){return"user"===e.role})).length&&2===ne.liveChatVersion&&!a?(e(),null):c&&c.length>0&&Object(h.jsxs)("div",{className:"webchat__typingIndicator",children:[Object(h.jsx)("div",{className:"bubble",style:{background:"#2266e3"}}),Object(h.jsx)("div",{className:"bubble",style:{background:"#2266e3"}}),Object(h.jsx)("div",{className:"bubble",style:{background:"#2266e3"}}),Object(h.jsxs)("div",{children:[" ","".concat(c[0].name||"Agent"," is typing...")," "]})]})}}};return t},oe=function(){var e={orgId:"d367c413-e0b9-408b-ae1c-382499b369ae",orgUrl:"https://omnichannel-crm.omnichannelengagementhub.com",widgetId:"3a352b95-5d67-4e47-af28-eca029b03928"},t=new URLSearchParams(window.location.search);return null!==t.get("orgUrl")&&(e.orgUrl=t.get("orgUrl")),null!==t.get("orgId")&&(e.orgId=t.get("orgId")),null!==t.get("widgetId")&&(e.widgetId=t.get("widgetId")),e},ie=function(){var e={telemetry:{disable:!1,ariaTelemetryKey:""}},t=new URLSearchParams(window.location.search);return null!==t.get("telemetry")&&(e.telemetry.disable="true"!=t.get("telemetry")),null!==t.get("ariaTelemetryKey")&&(e.telemetry.ariaTelemetryKey=t.get("ariaTelemetryKey")||""),e},le=function(){var e={disable:!0},t=new URLSearchParams(window.location.search);return null!==t.get("calling")&&(e.disable="false"==t.get("calling")),e},re=function(){var e={disable:!0},t=new URLSearchParams(window.location.search);return null!==t.get("debug")&&(e.disable="true"!=t.get("debug")),e},se=n(828),ue=(n(2019),oe()),de=ie(),be=le(),ge=re();console.log("%c [OmnichannelConfig]","background-color:#001433;color:#fff"),console.log(ue),console.log("%c [telemetryConfig]","background-color:#001433;color:#fff"),console.log(de),console.log("%c [callingConfig]","background-color:#001433;color:#fff"),console.log(be),console.log("%c [debugConfig]","background-color:#001433;color:#fff"),console.log(ge);var ve=X(),fe=ee(),he=te(),je={bubbleBorderRadius:10,bubbleNubSize:10,bubbleNubOffset:15,bubbleFromUserBorderRadius:10,bubbleFromUserNubSize:10,bubbleFromUserNubOffset:15,bubbleFromUserBackground:"rgb(246, 246, 246)"};var pe=function(){var e=Object(c.useContext)(C),t=e.state,n=e.dispatch,o=Object(c.useState)(),i=Object(b.a)(o,2),l=i[0],r=i[1],g=Object(c.useState)(void 0),j=Object(b.a)(g,2),p=j[0],m=j[1],O=Object(c.useState)(void 0),y=Object(b.a)(O,2),S=y[0],k=y[1],E=Object(c.useState)(void 0),T=Object(b.a)(E,2),M=T[0],N=T[1],A=Object(c.useState)(void 0),_=Object(b.a)(A,2),D=_[0],L=_[1],I=Object(c.useState)(void 0),R=Object(b.a)(I,2),W=R[0],H=R[1],F=Object(c.useState)(void 0),G=Object(b.a)(F,2),K=G[0],P=G[1],z=Object(c.useState)(void 0),J=Object(b.a)(z,2),q=J[0],X=J[1],Z=Object(c.useState)(void 0),$=Object(b.a)(Z,2),ee=$[0],te=$[1];Object(c.useEffect)((function(){var e=function(){var e=Object(d.a)(s.a.mark((function e(){var t,n,a,c,o;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new f.OmnichannelChatSDK(ue,Object(u.a)({},de))).setDebug(!ge.disable),e.next=4,t.initialize();case 4:return r(t),e.next=7,t.getLiveChatConfig();case 7:if(n=e.sent,ae(n),je.hideUploadButton=!ne.canUploadAttachment,(a=localStorage.getItem("liveChatContext"))&&Object.keys(JSON.parse(a)).length>0&&(console.log("[liveChatContext]"),console.log(a),m(a)),!t.getVoiceVideoCalling||be.disable){e.next=25;break}return e.prev=13,e.next=16,t.getVoiceVideoCalling();case 16:(c=e.sent).setDebug(!0),X(c),console.log("VoiceVideoCalling loaded"),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(13),console.log("Failed to load VoiceVideoCalling: ".concat(e.t0));case 25:return e.next=27,t.getPreChatSurvey(!1);case 27:(o=e.sent)&&(console.info("[PreChatSurvey]"),i=o,o=JSON.parse(i.replaceAll("&#42;","*")),console.log(o),k(o));case 29:case"end":return e.stop()}var i}),e,null,[[13,22]])})));return function(){return e.apply(this,arguments)}}();console.log(t),e()}),[]);var oe=Object(c.useCallback)((function(e){console.log("[onNewMessage] ".concat(e.content)),n({type:a.SET_LOADING,payload:!1})}),[n]),ie=Object(c.useCallback)((function(){console.log("[onTypingEvent]")}),[]),le=Object(c.useCallback)((function(){console.log("[onAgentEndSession]")}),[]),re=Object(c.useCallback)(function(){var e=Object(d.a)(s.a.mark((function e(c){var o,i,r,u,d,b,g,v=arguments;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=v.length>1&&void 0!==v[1]?v[1]:{},!t.hasChatStarted){e.next=3;break}return e.abrupt("return");case 3:return console.log("[startChat]"),i=ce((function(){null===l||void 0===l||l.sendTypingEvent()})),te((function(){return i})),e.next=8,null===l||void 0===l?void 0:l.getDataMaskingRules();case 8:if(r=e.sent,u=Y(),H(u.create()),u.subscribe("DataMasking",Q(r)),p&&Object.keys(JSON.parse(p)).length>0&&(console.log("[liveChatContext]"),o.liveChatContext=JSON.parse(p)),n({type:a.SET_CHAT_STARTED,payload:!0}),!p&&S){e.next=42;break}return n({type:a.SET_LOADING,payload:!0}),e.prev=16,e.next=19,null===l||void 0===l?void 0:l.startChat(o);case 19:e.next=25;break;case 21:return e.prev=21,e.t0=e.catch(16),console.log("Unable to start chat: ".concat(e.t0.message)),e.abrupt("return");case 25:return e.next=27,null===l||void 0===l?void 0:l.getCurrentLiveChatContext();case 27:return(d=e.sent)&&Object.keys(d).length&&(console.log("[newliveChatContext]"),console.log(d),localStorage.setItem("liveChatContext",JSON.stringify(d))),null===l||void 0===l||l.onNewMessage(oe,{rehydrate:!0}),null===l||void 0===l||l.onTypingEvent(ie),null===l||void 0===l||l.onAgentEndSession(le),e.next=34,null===l||void 0===l?void 0:l.createChatAdapter();case 34:if(b=e.sent,L(b),n({type:a.SET_LOADING,payload:!1}),!(null===l||void 0===l?void 0:l.getVoiceVideoCalling)){e.next=42;break}return e.next=40,null===l||void 0===l?void 0:l.getChatToken();case 40:g=e.sent,P(g);case 42:case"end":return e.stop()}}),e,null,[[16,21]])})));return function(t){return e.apply(this,arguments)}}(),[l,t,n,le,oe,ie,p,S]),pe=Object(c.useCallback)(Object(d.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[endChat]"),e.next=3,null===l||void 0===l?void 0:l.endChat();case 3:null===q||void 0===q||q.close(),L(void 0),P(void 0),m(void 0),k(void 0),N(void 0),localStorage.removeItem("liveChatContext"),n({type:a.SET_CHAT_STARTED,payload:!1});case 11:case"end":return e.stop()}}),e)}))),[l,n,q]),Ce=Object(c.useCallback)(Object(d.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[downloadTranscript]"),e.next=3,null===l||void 0===l?void 0:l.getLiveChatTranscript();case 3:t=e.sent,console.log(t);case 5:case"end":return e.stop()}}),e)}))),[l]),me=Object(c.useCallback)(Object(d.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("[emailTranscript]"),t={emailAddress:"foo@bar.com",attachmentMessage:"Transcript",locale:"en"},e.next=4,null===l||void 0===l?void 0:l.emailLiveChatTranscript(t);case 4:case"end":return e.stop()}}),e)}))),[l]),Oe=Object(c.useCallback)((function(){var e=new se.AdaptiveCard;e.parse(S),e.onExecuteAction=function(){var e=Object(d.a)(s.a.mark((function e(t){var c,o,i,r,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.data,N(c),o={},c&&(o.preChatResponse=c),n({type:a.SET_LOADING,payload:!0}),e.prev=5,e.next=8,null===l||void 0===l?void 0:l.startChat(o);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(5),console.log("Unable to start chat: ".concat(e.t0.message)),e.abrupt("return");case 14:return e.next=16,null===l||void 0===l?void 0:l.getCurrentLiveChatContext();case 16:return(i=e.sent)&&Object.keys(i).length&&localStorage.setItem("liveChatContext",JSON.stringify(i)),null===l||void 0===l||l.onNewMessage(oe,{rehydrate:!0}),null===l||void 0===l||l.onTypingEvent(ie),null===l||void 0===l||l.onAgentEndSession(le),e.next=23,null===l||void 0===l?void 0:l.createChatAdapter();case 23:if(r=e.sent,L(r),n({type:a.SET_LOADING,payload:!1}),!(null===l||void 0===l?void 0:l.getVoiceVideoCalling)){e.next=31;break}return e.next=29,null===l||void 0===l?void 0:l.getChatToken();case 29:u=e.sent,P(u);case 31:case"end":return e.stop()}}),e,null,[[5,10]])})));return function(t){return e.apply(this,arguments)}}();var t=e.render();return Object(h.jsx)("div",{ref:function(e){e&&e.firstChild&&e.removeChild(e.firstChild),t&&e&&e.appendChild(t)}})}),[l,S]);return Object(h.jsxs)(h.Fragment,{children:[Object(h.jsx)("div",{children:!t.hasChatStarted&&Object(h.jsx)(w,{onClick:re})}),t.hasChatStarted&&Object(h.jsxs)("div",{className:"chat-container",children:[Object(h.jsx)(V,{title:"Live Chat via Chat SDK",onClick:pe}),(!p||!Object.keys(p).length)&&S&&!M&&Oe(),t.isLoading&&Object(h.jsx)(x,{}),!be.disable&&q&&K&&Object(h.jsx)(U,{VoiceVideoCallingSDK:q,OCClient:null===l||void 0===l?void 0:l.OCClient,chatToken:K}),!t.isLoading&&t.hasChatStarted&&D&&W&&ve&&ee&&Object(h.jsx)(v.a,{activityMiddleware:ve,avatarMiddleware:fe,activityStatusMiddleware:he,typingIndicatorMiddleware:ee,userID:"teamsvisitor",directLine:D,sendTypingIndicator:!0,store:W,styleOptions:je}),!t.isLoading&&t.hasChatStarted&&D&&Object(h.jsx)(B,{onDownloadClick:Ce,onEmailTranscriptClick:me})]})]})},Ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,2047)).then((function(t){var n=t.getCLS,a=t.getFID,c=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),a(e),c(e),o(e),i(e)}))};l.a.render(Object(h.jsx)(o.a.StrictMode,{children:Object(h.jsx)(O,{children:Object(h.jsx)(pe,{})})}),document.getElementById("root")),Ce()},423:function(e,t){},424:function(e,t){},821:function(e,t){},842:function(e,t,n){},992:function(e,t){},994:function(e,t){}},[[2023,1,2]]]);
//# sourceMappingURL=main.ef65d4fe.chunk.js.map